import { Link, Outlet, useLocation } from "react-router-dom";
import { useEffect, useState } from "react";
import { useUserContext } from "../hooks/contextHooks";
import { useUser } from "../hooks/apiHooks";

const Layout = () => {
  const [role, setRole] = useState<string | null>(null);
  const location = useLocation();
  const { isLoggedIn } = useUserContext();
  const { getRoleByToken } = useUser();

  const implementCondition = async () => {
    const token = localStorage.getItem("token");
    if (token) {
      const role = await getRoleByToken();
      if (role === "admin") {
        setRole("admin");
      } else {
        setRole("user");
      }
    }
  };

  useEffect(() => {
    implementCondition();
  }, []);

  return (
    <>
      <div className="layout">
        <header>
          <nav className="navit">
            <ul>
              <li className="navi">
                <Link to="/login">
                  <p
                    className={`navi-p ${
                      location.pathname === "/login" ? "navi-p-active" : ""
                    }`}
                  >
                    <svg
                      width="20"
                      height="20"
                      viewBox="0 0 20 20"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        fillRule="evenodd"
                        clipRule="evenodd"
                        d="M6.25 3.95833C6.25 3.77583 8.13167 2.5 10 2.5C11.8683 2.5 13.75 3.77625 13.75 3.95833C13.75 4.60833 13.6808 4.99333 13.6225 5.20292C13.5837 5.34042 13.455 5.41667 13.3121 5.41667H6.68792C6.545 5.41667 6.41625 5.34042 6.3775 5.20292C6.31917 4.99333 6.25 4.60833 6.25 3.95833ZM9.375 3.75C9.26449 3.75 9.15851 3.7939 9.08037 3.87204C9.00223 3.95018 8.95833 4.05616 8.95833 4.16667C8.95833 4.27717 9.00223 4.38315 9.08037 4.46129C9.15851 4.53943 9.26449 4.58333 9.375 4.58333H10.625C10.7355 4.58333 10.8415 4.53943 10.9196 4.46129C10.9978 4.38315 11.0417 4.27717 11.0417 4.16667C11.0417 4.05616 10.9978 3.95018 10.9196 3.87204C10.8415 3.7939 10.7355 3.75 10.625 3.75H9.375Z"
                        fill="white"
                      />
                      <path
                        fillRule="evenodd"
                        clipRule="evenodd"
                        d="M6.68241 8.0075C5.29491 7.57833 5.64491 6.81167 6.17408 6.25H13.9416C14.3649 6.79083 14.592 7.52042 13.3124 7.95708C13.3647 8.42126 13.3189 8.89124 13.1779 9.33656C13.0368 9.78188 12.8038 10.1926 12.4939 10.5421C12.1839 10.8915 11.804 11.172 11.3787 11.3652C10.9534 11.5584 10.4923 11.66 10.0252 11.6635C9.55807 11.6671 9.09545 11.5724 8.66729 11.3856C8.23914 11.1988 7.85502 10.9242 7.53984 10.5794C7.22467 10.2347 6.98547 9.82752 6.83775 9.38438C6.69004 8.94124 6.63712 8.47199 6.68241 8.00708V8.0075ZM9.88658 8.33333C10.9874 8.33333 11.8407 8.275 12.4949 8.17333C12.5164 8.51305 12.4683 8.85358 12.3536 9.17405C12.2388 9.49452 12.0598 9.78818 11.8276 10.037C11.5953 10.2859 11.3147 10.4847 11.0029 10.6212C10.6911 10.7578 10.3547 10.8293 10.0143 10.8312C9.67391 10.8332 9.33671 10.7656 9.02336 10.6326C8.71 10.4997 8.42711 10.3041 8.192 10.058C7.9569 9.81181 7.77454 9.52023 7.65611 9.2011C7.53767 8.88197 7.48565 8.54202 7.50324 8.20208C8.11283 8.28625 8.89408 8.33333 9.88658 8.33333Z"
                        fill="white"
                      />
                      <path
                        fillRule="evenodd"
                        clipRule="evenodd"
                        d="M13.507 14.4167C13.1301 13.8287 12.6113 13.3449 11.9985 13.01C11.3856 12.675 10.6983 12.4997 9.99989 12.5C9.30118 12.4996 8.6136 12.675 8.00049 13.0101C7.38738 13.3452 6.86847 13.8292 6.49156 14.4175C6.35168 14.2021 6.13685 14.0462 5.88864 13.98L5.08364 13.7646C4.81683 13.6931 4.53252 13.7304 4.29326 13.8685C4.054 14.0066 3.87938 14.234 3.80781 14.5008L3.48448 15.7083C3.44906 15.8405 3.44003 15.9783 3.45789 16.1139C3.47574 16.2496 3.52014 16.3804 3.58855 16.4988C3.65696 16.6173 3.74803 16.7211 3.85657 16.8044C3.96511 16.8877 4.089 16.9488 4.22114 16.9842L5.02573 17.2C5.16106 17.2365 5.30238 17.2451 5.44115 17.2255C5.57993 17.2059 5.7133 17.1584 5.83323 17.0858C5.83356 17.1963 5.87777 17.3022 5.95615 17.3801C6.03452 17.458 6.14064 17.5016 6.25114 17.5012C6.36165 17.5009 6.4675 17.4567 6.54541 17.3783C6.62331 17.3 6.66689 17.1938 6.66656 17.0833V16.6667C6.66656 16.5079 6.67781 16.3517 6.69906 16.1988L8.86739 16.78C8.96804 16.9954 9.12806 17.1777 9.32865 17.3054C9.52925 17.4331 9.7621 17.5009 9.99989 17.5009C10.2377 17.5009 10.4705 17.4331 10.6711 17.3054C10.8717 17.1777 11.0317 16.9954 11.1324 16.78L13.3007 16.1988C13.322 16.3517 13.3332 16.5079 13.3332 16.6667V17.0833C13.3327 17.1938 13.376 17.3 13.4538 17.3786C13.5315 17.4571 13.6373 17.5015 13.7478 17.5021C13.8583 17.5026 13.9645 17.4593 14.043 17.3815C14.1216 17.3038 14.166 17.198 14.1666 17.0875C14.3999 17.2275 14.6882 17.2763 14.972 17.2L15.777 16.9846C15.9091 16.9492 16.033 16.8881 16.1415 16.8048C16.2501 16.7216 16.3412 16.6177 16.4096 16.4992C16.478 16.3808 16.5224 16.25 16.5402 16.1144C16.5581 15.9787 16.5491 15.8409 16.5136 15.7088L16.1899 14.5013C16.1183 14.2344 15.9437 14.007 15.7044 13.8689C15.4652 13.7308 15.1809 13.6935 14.9141 13.765L14.1091 13.9804C13.8614 14.0464 13.647 14.2016 13.507 14.4163V14.4167ZM6.91781 15.3946C7.14289 14.8502 7.50806 14.3752 7.97621 14.0177C8.44437 13.6602 8.99882 13.433 9.58323 13.3592V15.0713C9.3965 15.1375 9.22814 15.2471 9.09197 15.391C8.9558 15.5349 8.8557 15.7091 8.79989 15.8992L6.91781 15.395V15.3946ZM13.082 15.3946C12.8569 14.8503 12.4917 14.3752 12.0235 14.0177C11.5554 13.6602 11.001 13.433 10.4166 13.3592V15.0713C10.7932 15.2046 11.0874 15.5129 11.1999 15.8992L13.082 15.395V15.3946ZM9.99989 16.6667C10.1104 16.6667 10.2164 16.6228 10.2945 16.5446C10.3727 16.4665 10.4166 16.3605 10.4166 16.25C10.4166 16.1395 10.3727 16.0335 10.2945 15.9554C10.2164 15.8772 10.1104 15.8333 9.99989 15.8333C9.88939 15.8333 9.7834 15.8772 9.70526 15.9554C9.62712 16.0335 9.58323 16.1395 9.58323 16.25C9.58323 16.3605 9.62712 16.4665 9.70526 16.5446C9.7834 16.6228 9.88939 16.6667 9.99989 16.6667Z"
                        fill="white"
                      />
                    </svg>
                    {isLoggedIn ? "Admin profile" : "Admin login"}
                  </p>
                </Link>
              </li>
              <li
                className={`navi ${location.pathname === "/" ? "active" : ""}`}
              >
                <Link to="/">
                  <p
                    className={`navi-p ${
                      location.pathname === "/" ? "navi-p-active" : ""
                    }`}
                  >
                    <svg
                      width="20"
                      height="20"
                      viewBox="0 0 20 20"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        className={
                          location.pathname === "/" ? "navi-p-icon-H" : ""
                        }
                        d="M10 15V12.5"
                        stroke="white"
                        strokeWidth="1.5"
                        strokeLinecap="round"
                        strokeLinejoin="round"
                      />
                      <path
                        className={
                          location.pathname === "/" ? "navi-p-icon-H" : ""
                        }
                        d="M8.39172 2.35004L2.61672 6.97504C1.96672 7.4917 1.55006 8.58337 1.69172 9.40004L2.80006 16.0334C3.00006 17.2167 4.13339 18.175 5.33339 18.175H14.6667C15.8584 18.175 17.0001 17.2084 17.2001 16.0334L18.3084 9.40004C18.4417 8.58337 18.0251 7.4917 17.3834 6.97504L11.6084 2.35837C10.7167 1.6417 9.27506 1.6417 8.39172 2.35004Z"
                        stroke="white"
                        strokeWidth="1.5"
                        strokeLinecap="round"
                        strokeLinejoin="round"
                      />
                    </svg>
                    Home
                  </p>
                </Link>
              </li>
              <li
                className={`navi ${
                  location.pathname === "/devices" ? "active" : ""
                }`}
              >
                <Link to="/devices">
                  <p
                    className={`navi-p ${
                      location.pathname === "/devices" ? "navi-p-active" : ""
                    }`}
                  >
                    <svg
                      width="20"
                      height="20"
                      viewBox="0 0 20 20"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        className={
                          location.pathname === "/devices"
                            ? "navi-p-icon-D"
                            : ""
                        }
                        d="M14.4531 3.14453C13.2461 3.14453 12.2656 4.125 12.2656 5.33203C12.2656 6.31055 12.9121 7.14062 13.7988 7.41992V9.29297L6.25 11.7656V6.21289C7.11328 5.91992 7.73438 5.10156 7.73438 4.14062C7.73438 2.93359 6.75391 1.95312 5.54688 1.95312C4.33984 1.95312 3.35938 2.93359 3.35938 4.14062C3.35938 5.10156 3.98047 5.91797 4.84375 6.21289V13.7891C3.98047 14.082 3.35938 14.9004 3.35938 15.8613C3.35938 17.0684 4.33984 18.0488 5.54688 18.0488C6.75391 18.0488 7.73438 17.0684 7.73438 15.8613C7.73438 14.9004 7.11328 14.084 6.25 13.7891V13.2461L14.5215 10.5371C14.7201 10.4725 14.8931 10.3466 15.0156 10.1774C15.1381 10.0082 15.2038 9.80457 15.2031 9.5957V7.38672C16.041 7.07812 16.6406 6.27344 16.6406 5.33203C16.6406 4.125 15.6602 3.14453 14.4531 3.14453ZM4.60938 4.14062C4.61438 3.8953 4.71536 3.66171 4.89063 3.48998C5.0659 3.31825 5.3015 3.22207 5.54688 3.22207C5.79225 3.22207 6.02785 3.31825 6.20312 3.48998C6.37839 3.66171 6.47937 3.8953 6.48438 4.14062C6.47937 4.38595 6.37839 4.61954 6.20312 4.79127C6.02785 4.963 5.79225 5.05918 5.54688 5.05918C5.3015 5.05918 5.0659 4.963 4.89063 4.79127C4.71536 4.61954 4.61438 4.38595 4.60938 4.14062ZM6.48438 15.8594C6.47937 16.1047 6.37839 16.3383 6.20312 16.51C6.02785 16.6817 5.79225 16.7779 5.54688 16.7779C5.3015 16.7779 5.0659 16.6817 4.89063 16.51C4.71536 16.3383 4.61438 16.1047 4.60938 15.8594C4.61438 15.614 4.71536 15.3805 4.89063 15.2087C5.0659 15.037 5.3015 14.9408 5.54688 14.9408C5.79225 14.9408 6.02785 15.037 6.20312 15.2087C6.37839 15.3805 6.47937 15.614 6.48438 15.8594ZM14.4531 6.26953C14.2078 6.26452 13.9742 6.16355 13.8025 5.98828C13.6308 5.81301 13.5346 5.57741 13.5346 5.33203C13.5346 5.08665 13.6308 4.85105 13.8025 4.67578C13.9742 4.50051 14.2078 4.39954 14.4531 4.39453C14.6985 4.39954 14.932 4.50051 15.1038 4.67578C15.2755 4.85105 15.3717 5.08665 15.3717 5.33203C15.3717 5.57741 15.2755 5.81301 15.1038 5.98828C14.932 6.16355 14.6985 6.26452 14.4531 6.26953Z"
                        fill="white"
                      />
                    </svg>
                    Devices
                  </p>
                </Link>
              </li>

              {/^\/devices\/name\/[^\/]+$/.test(location.pathname) && (
                <li
                  className={`navi ${
                    /^\/devices\/name\/[^\/]+$/.test(location.pathname) // Ensure this pattern matches correctly
                      ? "active"
                      : ""
                  }`}
                >
                  <p
                    className={`navi-p ${
                      /^\/devices\/name\/[^\/]+$/.test(location.pathname) // Ensure this pattern matches correctly
                        ? "navi-p-active navi-p-icon-DO"
                        : ""
                    }`}
                  >
                    <svg
                      width="20"
                      height="17"
                      viewBox="0 0 20 17"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        className={
                          /^\/devices\/name\/[^\/]+$/.test(location.pathname)
                            ? "navi-p-icon-DO"
                            : ""
                        }
                        d="M13.3333 8.66668H14.5833V11.0167L16.6166 12.1917L15.9916 13.275L13.3333 11.7417V8.66668ZM14.1666 7.00001C13.0615 7.00001 12.0017 7.439 11.2203 8.2204C10.4389 9.0018 9.99992 10.0616 9.99992 11.1667C9.99992 12.2717 10.4389 13.3316 11.2203 14.113C12.0017 14.8944 13.0615 15.3333 14.1666 15.3333C15.2717 15.3333 16.3315 14.8944 17.1129 14.113C17.8943 13.3316 18.3333 12.2717 18.3333 11.1667C18.3333 10.0616 17.8943 9.0018 17.1129 8.2204C16.3315 7.439 15.2717 7.00001 14.1666 7.00001ZM14.1666 5.33334C15.7137 5.33334 17.1974 5.94793 18.2914 7.04189C19.3853 8.13585 19.9999 9.61958 19.9999 11.1667C19.9999 12.7138 19.3853 14.1975 18.2914 15.2915C17.1974 16.3854 15.7137 17 14.1666 17C11.8416 17 9.83325 15.6333 8.89159 13.6667H0.833252V11.1667C0.833252 8.95001 5.27492 7.83334 7.49992 7.83334C7.99992 7.83334 8.61659 7.89168 9.26659 8.00001C9.79515 7.18118 10.5207 6.50802 11.3767 6.04214C12.2327 5.57627 13.192 5.33257 14.1666 5.33334ZM8.33325 11.1667C8.33325 10.5833 8.41658 10.0167 8.57492 9.50001C8.22492 9.44168 7.85825 9.41668 7.49992 9.41668C5.02492 9.41668 2.41659 10.6333 2.41659 11.1667V12.0833H8.40825C8.35812 11.7804 8.33304 11.4738 8.33325 11.1667ZM7.49992 0.333344C8.38397 0.333344 9.23182 0.684533 9.85694 1.30965C10.4821 1.93478 10.8333 2.78262 10.8333 3.66668C10.8333 4.55073 10.4821 5.39858 9.85694 6.0237C9.23182 6.64882 8.38397 7.00001 7.49992 7.00001C6.61586 7.00001 5.76802 6.64882 5.1429 6.0237C4.51777 5.39858 4.16659 4.55073 4.16659 3.66668C4.16659 2.78262 4.51777 1.93478 5.1429 1.30965C5.76802 0.684533 6.61586 0.333344 7.49992 0.333344ZM7.49992 1.91668C7.03579 1.91668 6.59067 2.10105 6.26248 2.42924C5.93429 2.75743 5.74992 3.20255 5.74992 3.66668C5.74992 4.13081 5.93429 4.57593 6.26248 4.90411C6.59067 5.2323 7.03579 5.41668 7.49992 5.41668C7.96405 5.41668 8.40917 5.2323 8.73736 4.90411C9.06554 4.57593 9.24992 4.13081 9.24992 3.66668C9.24992 3.20255 9.06554 2.75743 8.73736 2.42924C8.40917 2.10105 7.96405 1.91668 7.49992 1.91668Z"
                        fill="#101010"
                      />
                    </svg>
                    Data overview
                  </p>
                </li>
              )}
              {role === "admin" && (
                <li
                  className={`navi ${
                    location.pathname === "/devices/detected" ? "active" : ""
                  }`}
                >
                  <Link to="/devices/detected">
                    <p
                      className={`navi-p ${
                        location.pathname === "/devices/detected"
                          ? "navi-p-active"
                          : ""
                      }`}
                    >
                      <svg
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          d="M18 16V11C18 7.68629 15.3137 5 12 5C8.68629 5 6 7.68629 6 11V16L4 18V19H20V18L18 16Z"
                          stroke="currentColor"
                          strokeWidth="2"
                          strokeLinecap="round"
                          strokeLinejoin="round"
                        />
                        <path
                          d="M13.73 21C13.5542 21.3031 13.3018 21.5545 12.9988 21.7294C12.6958 21.9042 12.3533 21.9961 12.003 21.9961C11.6527 21.9961 11.3102 21.9042 11.0072 21.7294C10.7042 21.5545 10.4518 21.3031 10.276 21"
                          stroke="currentColor"
                          strokeWidth="2"
                          strokeLinecap="round"
                          strokeLinejoin="round"
                        />
                      </svg>
                      Detected new devices
                    </p>
                  </Link>
                </li>
              )}
            </ul>
          </nav>
        </header>
        <main className="mainpage">
          <Outlet />
        </main>
      </div>
      <footer className="footer">
        <p>Device hub © 2024</p>
      </footer>
    </>
  );
};

export default Layout;
